# 记录类安卓应用需求文档（含图片插入功能）

## 1. 项目概述

本项目旨在开发一款基于安卓平台的记录类应用，采用 Kotlin 语言开发。应用支持笔记记录、自动时间戳、多维度检索，并新增**图片插入功能**，同时具备可扩展性（如标签可视化、数据统计），采用标准化数据存储格式确保跨平台可解读性。

## 2. 功能需求（新增图片相关内容，其余保持不变）

### 2.1 笔记记录功能（补充图片插入模块）



*   **自动时间记录**：创建 / 编辑笔记时自动记录时间戳（创建时间不可改，编辑时间实时更新，精确到分钟）。

*   **笔记内容编辑**：


    *   支持基本文本编辑（换行、加粗、列表等基础格式，可选拓展）。

    *   **图片插入与管理（新增核心功能）**：

1.  **图片来源**：支持两种获取方式，用户可自由选择：

*   相机拍摄：调用系统相机实时拍摄照片，直接插入笔记（需申请相机权限）。

*   相册选取：从手机本地相册中选择 1 张或多张图片插入（需申请存储 / 相册权限）。

1.  **图片操作**：插入后支持基础交互，满足日常使用需求：

*   预览：点击图片可全屏查看，支持手势缩放（放大 / 缩小）、左右滑动切换多图。

*   排序：长按图片可拖动调整在笔记中的显示顺序（如文本段落间的图片位置互换）。

*   删除：图片右上角显示 “删除图标”，点击可移除图片（需二次确认，防止误操作）。

*   压缩：系统自动对插入的图片进行轻量化压缩（默认压缩至 1024×1024 像素以内，画质保留 70%+），平衡图片清晰度与存储占用。

1.  **图片与文本关联**：图片可插入到任意文本段落中，保持 “文本 - 图片” 的排版顺序（如 “今日早餐 -【图片】- 花费 20 元”），编辑时不会出现排版错乱。

*   **标题管理**：每个笔记必须包含标题，作为检索和识别的核心标识。

### 2.2 标签系统（无变更）



*   标签添加：支持单条笔记关联多个标签。

*   固定标签格式：记账标签需遵循`记账_类型_金额`（如`记账_支出_50`），系统自动提取类型与金额；可拓展其他固定格式标签。

*   标签提取：固定格式标签的关键信息自动解析，用于后续统计。

### 2.3 检索功能（补充图片相关检索适配）



*   标题检索：支持关键词搜索笔记标题。

*   标签检索：支持单标签 / 多标签组合筛选，含图片的笔记无需额外筛选（默认包含在检索结果中）。

*   日期检索：支持具体日期、日期范围（开始 - 结束）、预设时间段（今天 / 本周 / 本月 / 今年）筛选。

*   组合检索：标题 + 标签 + 日期任意组合，检索结果中含图片的笔记需在列表中显示 “图片标识”（如缩略图角落小图标），方便用户快速识别。

### 2.4 数据可视化与统计（无变更）



*   标签日历可视化：特定标签（如 “吃早饭”）在日历上标记记录日期，点击可查看含图片 / 文本的笔记详情。

*   数据统计：任意时间段内指定标签的统计（如记账标签的收支汇总），含图片的笔记不影响统计逻辑，仅在详情中展示图片。

## 3. 数据存储与格式（重点补充图片相关规范）

### 3.1 数据存储方式（新增图片存储逻辑）



*   本地数据库：采用 Room（SQLite 封装）存储笔记的结构化数据（标题、时间、标签等）。

*   **图片存储（新增）**：

1.  存储路径：图片文件保存在应用私有目录（`/Android/data/[应用包名]/files/notes_images/`），避免被系统清理或其他应用访问。

2.  命名规则：图片文件名为`[noteId]_[timestamp]_[index].jpg`，其中：

*   `noteId`：对应笔记的唯一 UUID，确保图片与笔记关联。

*   `timestamp`：图片插入时的时间戳（毫秒级），避免文件名重复。

*   `index`：图片在当前笔记中的序号（如 01、02），用于恢复排版顺序。

1.  数据库关联：Room 数据库中仅存储图片的 “相对路径”（如`notes_images/note123_1690000000000_01.jpg`），不存储图片二进制数据，减少数据库体积。

### 3.2 数据格式规范（补充图片字段）

#### 3.2.1 笔记数据格式（JSON，新增`images`数组）



```
{

&#x20; "noteId": "唯一标识符（UUID，如：f47ac10b-58cc-4372-a567-0e02b2c3d479）",

&#x20; "title": "笔记标题（如：今日早餐记录）",

&#x20; "content": "笔记文本内容（如：今日早餐吃了三明治，搭配牛奶）",

&#x20; "creationTime": "创建时间（ISO 8601格式，如：2024-08-01T08:30:00+08:00）",

&#x20; "lastEditTime": "最后编辑时间（ISO 8601格式，如：2024-08-01T08:35:00+08:00）",

&#x20; "tags": \["吃早饭", "记账\_支出\_20"],

&#x20; "images": \[  // 新增：存储当前笔记的所有图片信息

&#x20;   {

&#x20;     "imagePath": "notes\_images/f47ac10b-58cc-4372-a567-0e02b2c3d479\_1690000000000\_01.jpg",  // 图片相对路径

&#x20;     "insertOrder": 1,  // 图片在笔记中的插入顺序（用于恢复排版）

&#x20;     "insertTime": "2024-08-01T08:32:00+08:00"  // 图片插入时间

&#x20;   },

&#x20;   {

&#x20;     "imagePath": "notes\_images/f47ac10b-58cc-4372-a567-0e02b2c3d479\_1690000000000\_02.jpg",

&#x20;     "insertOrder": 2,

&#x20;     "insertTime": "2024-08-01T08:33:00+08:00"

&#x20;   }

&#x20; ]

}
```

#### 3.2.2 批量导出格式（JSON，包含图片文件处理）



```
{

&#x20; "appVersion": "导出时应用版本（如：1.0.0）",

&#x20; "exportTime": "导出时间（ISO 8601格式，如：2024-08-01T10:00:00+08:00）",

&#x20; "notes": \[

&#x20;   // 多条笔记数据，每条含上述图片字段

&#x20; ],

&#x20; "imageInfo": {  // 新增：说明图片导出规则

&#x20;   "imageFolder": "导出压缩包中的图片目录名（固定为：notes\_images）",

&#x20;   "imageCount": 2,  // 本次导出的图片总数

&#x20;   "compressionRule": "图片已按1024×1024像素、70%画质压缩"

&#x20; }

}
```



*   **导出说明**：批量导出时，生成 ZIP 压缩包，包含：

1.  `notes_data.json`：上述批量导出格式的 JSON 文件。

2.  `notes_images/`：文件夹，存放所有笔记关联的图片文件（路径与 JSON 中的`imagePath`对应）。

3.  `数据格式说明.md`：详细解释字段含义、图片关联规则，确保跨平台解读。

### 3.3 数据格式文档（补充图片相关说明）



*   新增 “图片字段说明” 章节，明确`images`数组中每个子字段的含义（如`imagePath`对应导出包中的路径）、图片命名规则、压缩逻辑。

*   新增 “图片导出 / 导入流程”，说明 ZIP 包的结构、导入时如何恢复 “笔记 - 图片” 关联（如通过`noteId`匹配图片文件）。

## 4. 非功能需求（补充图片相关性能与兼容性）

### 4.1 性能需求（新增图片加载优化）



*   笔记检索响应时间≤1 秒（含图片的笔记列表加载时，显示图片缩略图而非原图，减少加载耗时）。

*   图片预览响应时间≤0.5 秒，缩放 / 滑动流畅无卡顿。

*   支持至少 1000 条笔记（每条含≤5 张图片）的流畅管理，应用无明显卡顿或内存溢出。

*   应用启动时间≤3 秒。

### 4.2 可扩展性（无变更）



*   分层架构（数据层 / 领域层 / UI 层），图片模块独立设计，后续可拓展 “图片标注”“图片云同步” 等功能。

*   标签系统、统计模块支持与图片功能联动（如未来可按 “含图片的记账笔记” 统计）。

### 4.3 兼容性（新增图片格式与设备适配）



*   系统版本：支持 Android 8.0（API 26）及以上。

*   图片格式：支持 JPG、PNG 格式（主流手机相机 / 相册输出格式），其他格式自动转换为 JPG。

*   屏幕适配：图片在不同分辨率屏幕上自动缩放，保持 “文本 - 图片” 排版一致性；横屏 / 竖屏切换时，图片位置不偏移。

### 4.4 安全性（补充图片安全）



*   本地图片存储在应用私有目录，仅应用可访问；导出时支持 ZIP 包加密（可选），保护图片隐私。

*   权限申请：仅在用户触发 “拍摄 / 选图” 功能时申请相机 / 存储权限，不提前申请；权限被拒绝时，提示 “无法使用图片功能”，不影响其他功能使用。

## 5. 界面需求（补充图片相关界面调整）



*   **主界面（笔记列表）**：含图片的笔记在列表项右侧显示 “小图缩略图”（如 80×80 像素），无图片则显示默认图标，帮助用户快速识别。

*   **笔记编辑界面（重点调整）**：


    *   工具栏新增 “图片按钮”（相机图标），点击弹出 “拍摄 / 选图” 选项弹窗。

    *   编辑区域中，图片按插入顺序显示，宽度适配屏幕，高度按比例缩放；长按图片弹出 “预览 / 删除 / 调整顺序” 菜单。

    *   图片插入后，光标自动定位到图片下方，方便继续输入文本。

*   **检索界面**：无额外调整，仅在结果列表中显示图片缩略图标识。

*   **图片预览界面（新增）**：全屏显示当前图片，顶部显示 “关闭按钮”，底部显示 “上一张 / 下一张” 切换按钮（多图时），支持双指缩放、双击放大 / 还原。

*   **统计 / 日历界面**：点击日历标记查看笔记详情时，完整展示文本与图片（图片按缩略图 + 点击预览的方式呈现，避免详情页过长）。

## 6. 技术架构（补充图片相关技术选型）



*   语言：Kotlin

*   架构模式：MVVM（Model-View-ViewModel）

*   数据存储：


    *   结构化数据：Room 数据库（存储笔记信息、图片路径等）。

    *   图片文件：应用私有目录（通过`Context.getExternalFilesDir()`获取路径）。

*   图片处理技术（新增）：


    *   压缩：采用`Luban`或`Compressor`库，实现自动轻量化压缩。

    *   加载：采用`Glide`或`Coil`库，支持图片缓存、缩略图加载、淡入动画，优化加载性能。

    *   权限处理：采用`Activity Result API`（替代旧版`onActivityResult`），处理相机 / 相册权限申请与结果回调。

*   依赖注入：Hilt

*   异步处理：Kotlin Coroutines + Flow（处理图片压缩、文件读写等耗时操作）

*   UI 组件：Jetpack Compose（实现编辑界面、预览界面的图片排版与交互）

*   图表库：MPAndroidChart（用于数据可视化）

## 7. 后续可扩展功能（补充图片相关拓展方向）



*   图片标注：支持在插入的图片上添加文字、涂鸦标记。

*   图片云同步：结合云存储（如阿里云 OSS、Firebase Storage），实现多设备图片同步。

*   图片 OCR：识别图片中的文字（如账单图片），自动提取信息到笔记（如记账金额）。

*   自定义图片压缩：允许用户手动选择压缩质量（低 / 中 / 高）。

## 8. 验收标准（补充图片相关验收项）



*   图片功能：拍摄 / 选图插入正常，预览、删除、排序操作无异常；图片与笔记关联正确，卸载重装后（导入备份）图片可正常显示。

*   性能：列表加载含图片的笔记无卡顿，图片预览响应迅速，压缩后的图片文件大小≤500KB（单张）。

*   兼容性：在 Android 8.0、10.0、13.0 设备上测试，图片功能无崩溃；横屏 / 竖屏切换时排版正常。

*   数据迁移：导出的 ZIP 包在其他设备（或未来更换架构后）导入时，笔记与图片可完整恢复，无丢失或错乱。

*   权限：未授予相机 / 存储权限时，图片功能不可用但不影响其他功能，提示清晰。



***

本需求文档可根据开发过程中的反馈调整，确保图片功能与核心功能无缝融合，满足用户 “图文结合记录” 的使用场景。

